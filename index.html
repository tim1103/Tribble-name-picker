<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éšæœºç‚¹å</title>
    <link href="bootstrap.min.css" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'HarmonyOS Sans SC';
            src: url('fonts/HarmonyOS Sans SC Thin.ttf') format('truetype');
            font-weight: 100;
            font-style: normal;
        }

        @font-face {
            font-family: 'HarmonyOS Sans SC';
            src: url('fonts/HarmonyOS Sans SC Light.ttf') format('truetype');
            font-weight: 300;
            font-style: normal;
        }

        @font-face {
            font-family: 'HarmonyOS Sans SC';
            src: url('fonts/HarmonyOS Sans SC Regular.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'HarmonyOS Sans SC';
            src: url('fonts/HarmonyOS Sans SC Medium.ttf') format('truetype');
            font-weight: 500;
            font-style: normal;
        }

        @font-face {
            font-family: 'HarmonyOS Sans SC';
            src: url('fonts/HarmonyOS Sans SC Bold.ttf') format('truetype');
            font-weight: 700;
            font-style: normal;
        }

        @font-face {
            font-family: 'HarmonyOS Sans SC';
            src: url('fonts/HarmonyOS Sans SC Black.ttf') format('truetype');
            font-weight: 900;
            font-style: normal;
        }

        html {
            font-family: 'HarmonyOS Sans', sans-serif;
        }

        body {
            margin: 0;
            font-family: 'HarmonyOS Sans', sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            height: 60px;
        }

        .navbar h1 {
            margin: 0;
            font-size: 24px;
            font-family: 'HarmonyOS Sans', sans-serif;
        }

        .navbar .class-info {
            font-size: 18px;
        }

        .navbar button {
            width: 120px;
            height: 40px;
            cursor: pointer;
            margin-left: 10px;
        }

        .main-container {
            flex: 1;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            padding: 10px;
            background-color: #f0f0f0;
        }

        .student-box {
            width: 100px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            /* éšè—æº¢å‡ºçš„å†…å®¹ */
        }

        /*.highlight {
            background-color: #ffc107;
        }*/

        .bottom-buttons {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: #ffffff;

        }

        .bottom-buttons button {
            border: none;
            cursor: pointer;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            position: relative;
            margin: 5em;
        }

        .modal-content button {
            margin-top: 10px;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 20px;
        }



        .names {
            font-size: 2.5em;
        }

        .number-button {
            width: 2.2em;
            height: 2.2em;
            font-size: 2rem;
            margin: 8px;
            border-radius: 50%;
            --bs-btn-padding-x: 0;
            --bs-btn-padding-y: 0;
        }

        .hidden {
            display: none;
        }

        #dragonCards {
            font-size: 2em;
        }

        /* è®¾ç½®è¡¨æ ¼è¾¹æ¡† */
        table,
        th,
        td {
            border: 1.5px solid #484848;
        }

        /* è®¾ç½®è¡¨æ ¼å®½åº¦ä¸º100%ï¼Œå¹¶ä¸”ä½¿è¾¹æ¡†åˆå¹¶ */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        /* è®¾ç½®è¡¨å¤´å’Œå•å…ƒæ ¼çš„å†…è¾¹è· */
        th,
        td {
            padding: 12px;
            text-align: center;
            font-size: 1.3em;
        }

        .navbar {
            -webkit-app-region: drag;
            /* è®©å¯¼èˆªæ å¯æ‹–åŠ¨ */
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            height: 60px;
        }

        /*ä¾›electronå®Œæˆæ‹–åŠ¨é€»è¾‘*/
        .navbar button {
            -webkit-app-region: no-drag;
            /* æŒ‰é’®ä¸å¯æ‹–åŠ¨ */
            cursor: pointer;
            border-radius: 10px;
        }

        .window-controls {
            display: flex;
            gap: 10px;
        }

        .window-controls button {
            background: rgba(0, 0, 0, 0);
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        .controlbutton {
            border-radius: 5px;
        }

        .window-controls button {
            height: 35px;
            width: 35px;
        }

        #dragonCard {
            margin: 10px 0;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            text-align: center;
            opacity: 1;
            font-size: 2.5em;
            font-weight: bolder;
        }

        /* æ–°å¢ç­çº§åˆ—è¡¨æ ·å¼ */
        .class-list-container {
            max-height: 60vh;
            overflow-y: auto;
            margin: 20px 0;
        }

        .class-item {
            padding: 12px;
            margin: 5px 0;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        /* ç½‘æ ¼å¸ƒå±€æ ·å¼ */
        .class-list-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            max-height: 60vh;
            overflow-y: auto;
            padding: 10px;
            width: 80vw;
            /* æ§åˆ¶æ¨¡æ€æ¡†å®½åº¦ */

        }

        .class-list-container div {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.2s ease;
            font-size: 1rem;
        }

        .class-item {
            width: 100px;
            height: 50px;
            background-color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #e6e6e6;
            border-radius: 5px;
            box-shadow: 1px 1px 1px 1px rgb(196 196 196 / 20%);
            cursor: pointer;
            transition: all 0.2s;
            padding: 5px;
            text-align: center;
            word-break: break-all;
            /* é•¿ç­çº§åè‡ªåŠ¨æ¢è¡Œ */
        }

        /* æ–°å¢åŠ¨ç”»ç›¸å…³æ ·å¼ */
        .modal {
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            transform: translateY(-50px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .modal.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }


        /* å…³é—­æ—¶åå‘åŠ¨ç”» */
        .modal:not(.show) .modal-content {
            transition: all 0.2s ease-out;
        }

        /* æ–°å¢åª’ä½“æŸ¥è¯¢ */
        @media (max-width: 960px) {
            .navbar {
                flex-wrap: wrap;
                height: auto;
                padding: 10px;
            }

            .navbar h1 {
                font-size: 1.2rem;
                margin-bottom: 8px;
            }

            .class-info {
                order: 3;
                width: 100%;
                text-align: center;
                font-size: 0.9rem;
                margin-top: 8px;
            }

            .navbar>button {
                width: auto;
                padding: 0 8px;
                font-size: 0.8rem;
                height: 32px;
                margin: 2px;
            }

            .window-controls button {
                width: 28px;
                height: 28px;
            }

            .bottom-buttons {
                flex-wrap: wrap;
                height: auto;
                padding: 8px;
            }

            .bottom-buttons button {
                width: 48%;
                margin: 4px 1%;
                font-size: 0.9rem;
                padding: 8px;
            }
        }

        @media (max-width: 576px) {
            .navbar>button {
                font-size: 0.7rem;
                padding: 0 4px;
            }

            .bottom-buttons button {
                width: 100%;
                margin: 4px 0;
            }

            .main-container {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }

            .student-box {
                width: 80px;
                height: 40px;
                font-size: 0.8rem;
            }
        }

        /* ä¿®æ”¹ç°æœ‰æ ·å¼ */
        .navbar {
            gap: 8px;
            /* æ·»åŠ é—´è· */
            padding: 0 10px;
        }

        .navbar>button {
            min-width: 80px;
            /* æ›¿ä»£å›ºå®šå®½åº¦ */
            width: auto;
            padding: 3px 8px 3px;
            white-space: nowrap;
            /* é˜²æ­¢æŒ‰é’®æ–‡å­—æ¢è¡Œ */
        }

        .bottom-buttons {
            gap: 8px;
            padding: 10px;
        }

        .window-controls {
            flex-shrink: 0;
            /* é˜²æ­¢çª—å£æ§åˆ¶æŒ‰é’®è¢«å‹ç¼© */
        }

        /* æ–°å¢æŠ˜å èœå•æ ·å¼ */
        .nav-collapse {
            position: relative;
            display: flex;
            align-items: center;
        }

        .nav-menu-toggle {
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            min-width: 160px;
            z-index: 1000;
            display: none;
        }

        .nav-menu.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .nav-menu button {
            width: 100%;
            text-align: left;
            padding: 8px 16px;
            border: none;
            background: none;
            border-radius: 0;

        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ä¿®æ”¹åŸæœ‰åª’ä½“æŸ¥è¯¢ */
        @media (max-width: 700px) {
            .class-info {
                order: 3;
                width: 100%;
                text-align: center;
                font-size: 0.9rem;
                margin-top: 8px;
            }

            .nav-buttons {
                display: none !important;
            }

            .nav-menu-toggle {
                display: flex !important;
            }
        }

        @media (min-width: 700px) {
            .nav-menu {
                display: none !important;
            }
        }

        /* æ–°å¢é¢œè‰²å˜é‡ */
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --accent-color: #4895ef;
            --background: #f8f9fa;
            --text-primary: #2b2d42;
            --text-secondary: #8d99ae;
        }

        /* æ•´ä½“èƒŒæ™¯å’Œå­—ä½“ä¼˜åŒ– */
        body {
            background: var(--background);
            color: var(--text-primary);

        }

        /* å¯¼èˆªæ ç°ä»£åŒ–æ”¹é€  */
        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);

            padding: 0 2rem;
        }

        .navbar h1 {
            font-weight: 700;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* ä¸»å†…å®¹åŒºå¡ç‰‡æ ·å¼ */
        .main-container {
            background: transparent;
            padding: 1.5rem;
            gap: 1.2rem;
        }

        .student-box {
            background: white;
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.2s ease;
            height: 50px;
            font-size: 1rem;
        }

        .highlight {
            background: var(--accent-color) !important;
            color: white;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        /* åº•éƒ¨æŒ‰é’®ç»„ä¼˜åŒ– */
        .bottom-buttons {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            gap: 1rem;
        }

        .bottom-buttons button {
            border-radius: 10px;
            padding: 0.8rem 1.5rem;
            font-weight: 500;
            transition: all 0.2s ease;
            min-width: 140px;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        /* æ¨¡æ€æ¡†ç°ä»£åŒ– */
        .modal-content {
            border-radius: 15px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            border: none;
            padding: 1.5rem;
        }

        .modal-content h3 {
            color: var(--text-primary);
            margin-bottom: 1.5rem;
        }

        .close-btn {
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }


        /* è¡¨æ ¼ä¼˜åŒ– */
        table {
            border-radius: 12px;
            overflow: hidden;
            background: white;
        }

        th {
            background: var(--primary-color);
            color: white !important;
            font-weight: 600;
        }

        td {
            background: rgba(237, 237, 238, 0.8);
        }

        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 768px) {
            .navbar {
                padding: 0 1rem;
                height: 60px;
            }

            .navbar h1 {
                font-size: 1.4rem;
            }

            .student-box {
                height: 60px;
                font-size: 1rem;
            }

            .bottom-buttons button {
                width: 100%;
                padding: 0.8rem;
                font-size: 0.95rem;
            }
        }

        /* çª—å£æ§åˆ¶æŒ‰é’®ç¾åŒ– */
        .window-controls button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        /* æ–°å¢æ•°å­—é€‰æ‹©å™¨æ ·å¼ */
        .number-picker {
            text-align: center;
            padding: 0 20px;
        }

        .rounded-circle {
            width: 55px;
            height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #4361ee;
            color: white;
            font-size: 2.2em;
            transition: all 0.2s;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        /* æ·»åŠ ç©ºçŠ¶æ€æç¤ºæ ·å¼ */
        .empty-state {
            width: 100%;
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state svg {
            opacity: 0.6;
            margin-bottom: 15px;
        }

        .empty-state h3 {
            font-size: 1.5em;
            margin: 10px 0;
        }

        .empty-state p {
            font-size: 1.1em;
        }

        .minimize-button {
            padding: 0 0 0 0 !important;
            min-width: 65px !important;
        }

        #columnValue {
            font-size: 3rem !important;
        }

        #rowValue {
            font-size: 3rem !important;
        }

        .close-btn {
            position: absolute;
            top: 0;
            right: 0;
            width: 50px !important;
            /* å¢å¤§è§¦æ§åŒºåŸŸ */
            height: 50px !important;
            padding: 15px !important;
            /* æ‰©å¤§å¯ç‚¹å‡»åŒºåŸŸ */
            font-size: 28px !important;
            display: flex !important;
            align-items: center;
            justify-content: center;
            opacity: 0.8;
            transition: all 0.2s;
        }

        /* å¢åŠ å…³é—­æŒ‰é’®çš„ä¼ªå…ƒç´ æ‰©å¤§ç‚¹å‡»åŒºåŸŸ */
        .close-btn::after {
            content: "";
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
        }

        /* è€è™æœºåŠ¨ç”»æ ·å¼ */
        .slot-machine {
            height: 120px;
            /* å›ºå®šé«˜åº¦é¿å…æ¨¡æ€æ¡†è·³åŠ¨ */
            overflow: hidden;
            position: relative;
            /*margin: 20px 0;*/
        }

        .slot-container {
            position: absolute;
            width: 100%;
            transition: transform 0.1s ease-out;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .slot-item {
            font-size: 2.5em !important;
            /* ä¿æŒä¸åŸç‰ˆç›¸åŒçš„å­—å· */
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bolder;
        }

        .slot-container {
            transition-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
            /* æ·»åŠ easeOutQuadæ›²çº¿ */
        }

        .tips {
            margin-bottom: 0.1em;
        }

        /* å¤šäººåŠ¨ç”»å®¹å™¨ */
        #multiSlotMachine {
            height: 120px;
            margin: 20px 0;
        }

        /* é«˜äº®å¤šä¸ªå­¦ç”Ÿ */
        .highlight-multi {
            background: #ff6b6b !important;
            color: white;
            animation: pulseMulti 1s infinite;
        }

        @keyframes pulseMulti {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.03);
            }

            100% {
                transform: scale(1);
            }
        }

        /* æ–°å¢å¤šåˆ—å¸ƒå±€æ ·å¼ */
        .multi-slot-column {
            width: 120px;
            height: 140px;
            overflow: hidden;
            position: relative;
        }

        .multi-slot-container {
            position: absolute;
            width: 100%;
            transition: transform 0.1s ease-out;
        }

        .multi-slot-column {
            width: 120px;
            height: 140px;
            overflow: hidden;
            position: relative;
            background: white;
            /*border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);*/
        }

        /* æ–°å¢ç»“æœæ ·å¼ */
        .slot-item:last-child {
            /*color: var(--primary-color);*/
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="navbar">
        <div class="d-flex align-items-center gap-3">
            <h1 style="color: white;">ğŸ¯ éšæœºç‚¹å</h1>
            <div class="class-info text-light opacity-85">
                <span id="className">é«˜ä¸€8ç­</span>
                <span class="mx-2">|</span>
                <span id="studentCount">0äºº</span>
            </div>
        </div>
        <!-- æ–°å¢æŠ˜å èœå• -->
        <div class="nav-collapse">
            <!-- åŸæœ‰æŒ‰é’®ç»„ -->
            <div class="nav-buttons d-none d-md-flex">
                <button onclick="showAboutModal()" class="btn btn-info">å…³äº</button>
                <button onclick="showClassModal()" class="btn btn-info">é€‰æ‹©ç­çº§</button>
                <button onclick="importList()" class="btn btn-info">å¯¼å…¥åå•</button>
            </div>

            <!-- æŠ˜å èœå•æŒ‰é’® -->
            <button class="nav-menu-toggle btn btn-info d-md-none toggleNavMenu" onclick="toggleNavMenu()">
                è®¾ç½®
            </button>
        </div>

        <div class="window-controls d-flex align-items-center gap-2">
            <button class="controlbutton" id="minimize-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                    height="16" fill="currentColor" class="bi bi-dash-lg" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2 8a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11A.5.5 0 0 1 2 8Z" />
                </svg></button> <!-- æœ€å°åŒ–æŒ‰é’® -->
            <button class="controlbutton" id="maximize-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                    height="16" fill="currentColor" class="bi bi-square" viewBox="0 0 16 16">
                    <path
                        d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z" />
                </svg></button> <!-- æœ€å¤§åŒ–æŒ‰é’® -->
            <button class="controlbutton" id="close-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                    fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                    <path
                        d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z" />
                </svg></button> <!-- å…³é—­æŒ‰é’® -->
        </div>
    </div>
    <div class="main-container" id="studentContainer"></div>
    <div class="bottom-buttons">
        <button class="minimize-button" id="minimize-btn-bottom">
            <div class="minimize-icon"><svg t="1738978714323" class="icon" viewBox="0 0 1024 1024" version="1.1"
                    xmlns="http://www.w3.org/2000/svg" p-id="4168" width="35">
                    <path
                        d="M319.27 641.9H190.79c-34.64 0-62.83 28.18-62.83 62.83v128.48c0 34.64 28.18 62.83 62.83 62.83h128.48c34.64 0 62.83-28.18 62.83-62.83V704.73c0-34.65-28.18-62.83-62.83-62.83z m22.83 191.31c0 12.59-10.24 22.83-22.83 22.83H190.79c-12.59 0-22.83-10.24-22.83-22.83V704.73c0-12.59 10.24-22.83 22.83-22.83h128.48c12.59 0 22.83 10.24 22.83 22.83v128.48z"
                        fill="#333333" p-id="4169"></path>
                    <path
                        d="M790.38 127.96H276.45c-58.26 0-105.66 47.4-105.66 105.66v256.97c0 11.05 8.95 20 20 20s20-8.95 20-20V233.62c0-36.2 29.45-65.66 65.66-65.66h513.94c36.2 0 65.66 29.45 65.66 65.66v513.94c0 36.2-29.45 65.66-65.66 65.66H533.41c-11.05 0-20 8.95-20 20s8.95 20 20 20h256.97c58.26 0 105.66-47.4 105.66-105.66V233.62c0-58.26-47.4-105.66-105.66-105.66z"
                        fill="#333333" p-id="4170"></path>
                    <path
                        d="M478.64 549.43c0.28 0.21 0.55 0.42 0.84 0.62 0.29 0.19 0.59 0.36 0.89 0.54 0.26 0.16 0.52 0.32 0.79 0.47 0.3 0.16 0.61 0.3 0.92 0.44 0.28 0.13 0.56 0.27 0.85 0.39 0.3 0.12 0.61 0.22 0.91 0.33 0.31 0.11 0.62 0.23 0.94 0.33 0.3 0.09 0.61 0.16 0.92 0.24 0.33 0.08 0.65 0.17 0.98 0.24 0.35 0.07 0.71 0.11 1.06 0.16 0.29 0.04 0.58 0.1 0.87 0.13 0.66 0.06 1.31 0.1 1.97 0.1H661.9c11.05 0 20-8.95 20-20s-8.95-20-20-20H538.87l180-180c7.81-7.81 7.81-20.47 0-28.28-7.81-7.81-20.47-7.81-28.29 0l-180 180V362.1c0-11.05-8.95-20-20-20s-20 8.95-20 20v171.31c0 0.66 0.03 1.32 0.1 1.97 0.03 0.3 0.09 0.59 0.13 0.88 0.05 0.35 0.09 0.7 0.16 1.05 0.07 0.34 0.16 0.66 0.24 0.99 0.08 0.3 0.14 0.61 0.23 0.91 0.1 0.32 0.22 0.63 0.33 0.95 0.11 0.3 0.21 0.6 0.33 0.9 0.12 0.29 0.27 0.58 0.4 0.86 0.14 0.31 0.28 0.61 0.44 0.91 0.15 0.27 0.31 0.53 0.47 0.8 0.18 0.29 0.34 0.59 0.53 0.88 0.2 0.29 0.41 0.57 0.62 0.85 0.18 0.24 0.35 0.49 0.54 0.72 0.41 0.49 0.84 0.97 1.29 1.42 0.01 0.01 0.02 0.03 0.04 0.04l0.05 0.05c0.45 0.45 0.92 0.87 1.41 1.28 0.26 0.21 0.51 0.38 0.75 0.56z"
                        fill="#333333" p-id="4171"></path>
                </svg></div>
            <span style="font-size: 0.8em;">æœ€å°åŒ–</span>
        </button>
        <button onclick="pickOne()" class="btn btn-lg btn-primary col-12 col-sm-auto">æŠ½å–ä¸€äºº</button>
        <button onclick="showNumberSelection()" class="btn btn-lg btn-success col-12 col-sm-auto">æŠ½å–å¤šäºº</button>
        <button onclick="dragonPick()" class="btn btn-lg btn-warning col-12 col-sm-auto">æ¥é¾™æŠ½é€‰</button>
        <button onclick="randomSeatAssignment()" class="btn btn-lg btn-info col-12 col-sm-auto">éšæœºé€‰åº§</button>
    </div>
    <!-- æ¨¡æ€æ¡†æ¨¡æ¿ -->
    <div id="seatModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('seatModal')">&times;</span>
            <h3 style="font-weight: bolder;">åº§ä½å®‰æ’</h3>
            <table id="seatTable" border="1" cellpadding="5" cellspacing="0"></table>
            <div style="margin-top: 10px; text-align: center;">
                <button onclick="randomSeatAssignment(true)" class="btn btn-primary">é‡æ–°åˆ†é…</button>
            </div>
        </div>
    </div>
    <!-- æ¨¡æ€æ¡†æ¨¡æ¿ -->
    <div id="oneModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('oneModal')">&times;</span>
            <p class="tips">è¢«é€‰ä¸­çš„åŒå­¦æ˜¯ï¼š</p>
            <!-- æ–°å¢åŠ¨ç”»å®¹å™¨ -->
            <div id="slotMachine" class="slot-machine">
                <div class="slot-container"></div>
            </div>
            <!--<p id="selectedStudent"></p>-->
            <button onclick="pickOne()" class="btn btn-primary" id="pickOneButton">æ¢ä¸€äºº</button>
        </div>
    </div>
    <!-- ä¿®æ”¹multipleModalçš„HTMLç»“æ„ -->
    <div id="multipleModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('multipleModal')">&times;</span>
            <!-- åˆå§‹é€‰æ‹©ç•Œé¢ -->
            <div id="numberSelectionUI">
                <p>è¯·é€‰æ‹©æŠ½å–äººæ•°ï¼š</p>
                <div>
                    <button onclick="selectNumber(1)" class="btn btn-primary number-button">1</button>
                    <button onclick="selectNumber(2)" class="btn btn-primary number-button">2</button>
                    <button onclick="selectNumber(3)" class="btn btn-primary number-button">3</button>
                    <button onclick="selectNumber(4)" class="btn btn-primary number-button">4</button>
                    <button onclick="selectNumber(5)" class="btn btn-primary number-button">5</button>
                    <button onclick="selectNumber(6)" class="btn btn-primary number-button">6</button>
                </div>
            </div>

            <!-- æŠ½å–ç»“æœæ˜¾ç¤ºç•Œé¢ -->
            <div id="resultUI" style="display:none;">
                <p id="selectionCountText"></p>
                <div id="multiSlotsContainer" class="d-flex flex-wrap justify-content-center gap-3"></div>
                <button onclick="pickMultiple()" id="rePickButton" class="btn btn-primary mt-3">æ¢ä¸€ç»„</button>
            </div>
        </div>
    </div>

    <div id="dragonModal" class="modal">
        <div class="modal-content roster-modal">
            <span class="close-btn" onclick="closeModal('dragonModal')">&times;</span>
            <div id="dragonCard" class="card">è¯·ç‚¹å‡»â€œä¸‹ä¸€ä½â€å¼€å§‹æŠ½é€‰</div>
            <button onclick="nextDragonPick()" class="btn btn-primary">ä¸‹ä¸€ä½</button>
        </div>
    </div>
    <!-- æ–°å¢ç­çº§é€‰æ‹©æ¨¡æ€æ¡† -->
    <div id="classModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('classModal')">&times;</span>
            <h3 style="font-weight: bolder;">è¯·é€‰æ‹©ç­çº§</h3>
            <div id="classList" class="class-list-container"></div>
        </div>
    </div>
    <div id="seatSettingModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('seatSettingModal')">&times;</span>
            <h3 style="font-weight: bolder;">åº§ä½è®¾ç½®</h3>
            <div class="d-flex justify-content-around my-4">
                <!-- åˆ—æ•°é€‰æ‹©å™¨ -->
                <div class="number-picker">
                    <div class="text-center mb-2">åˆ—æ•°</div>
                    <div class="d-flex align-items-center">
                        <button class="btn btn-primary rounded-circle px-3 py-1" onclick="adjustColumn(-1)">-</button>
                        <span id="columnValue" class="mx-3 fs-4">8</span>
                        <button class="btn btn-primary rounded-circle px-3 py-1" onclick="adjustColumn(1)">+</button>
                    </div>
                </div>
                <!-- è¡Œæ•°é€‰æ‹©å™¨ -->
                <div class="number-picker">
                    <div class="text-center mb-2">è¡Œæ•°</div>
                    <div class="d-flex align-items-center">
                        <button class="btn btn-primary rounded-circle px-3 py-1" onclick="adjustRow(-1)">-</button>
                        <span id="rowValue" class="mx-3 fs-4">1</span>
                        <button class="btn btn-primary rounded-circle px-3 py-1" onclick="adjustRow(1)">+</button>
                    </div>
                </div>
            </div>
            <div class="text-center mt-3">
                <button onclick="generateSeat()" class="btn btn-primary">ç¡®å®š</button>
            </div>
        </div>
    </div>
    <script src="sheet.js"></script>
    <script>
        let students = [];
        let selectedNumber = 0;
        let selectedStudents = [];

        function importList() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt';
            input.onchange = function (e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const lines = event.target.result.split('\n').filter(line => line.trim());
                        if (lines.length === 0) {
                            Swal.fire({
                                icon: "error",
                                title: "æ–‡ä»¶æ ¼å¼é”™è¯¯",
                                confirmButtonColor: "#3085d6",
                                text: "å¯¼å…¥çš„åå•æ–‡ä»¶ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥åé‡æ–°ä¸Šä¼ ï¼"
                            });
                            return;
                        }
                        students = lines;
                        const className = file.name.split('.').slice(0, -1).join('.');
                        document.getElementById('className').innerText = className;
                        updateStudentCount();
                        renderStudents();
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function updateStudentCount() {
            document.getElementById('studentCount').innerText = `${students.length}äºº`;
        }

        function renderStudents() {
            const container = document.getElementById('studentContainer');
            container.innerHTML = '';
            students.forEach(student => {
                const div = document.createElement('div');
                div.className = 'student-box';
                div.innerText = student;
                container.appendChild(div);
            });
        }

        function highlightStudents(indices, clearAll) {
            const boxes = document.querySelectorAll('.student-box');
            boxes.forEach((box, index) => {
                box.classList.remove('highlight');
                if (!clearAll && indices.includes(index)) {
                    box.classList.add('highlight');
                }
            });
        }


        let multiAnimationLock = false;
        function pickMultiple() {
            if (multiAnimationLock) return;
            if (!selectedNumber || selectedNumber < 1) {
                Swal.fire("");
                Swal.fire({
                    icon: "error",
                    title: "è¯·å…ˆé€‰æ‹©äººæ•°",
                    text: `å½“å‰é€‰æ‹©äººæ•°ä¸º0ï¼`
                });
                return;
            }

            if (students.length < selectedNumber) {
                Swal.fire({
                    icon: "error",
                    title: "äººæ•°è¿‡å°‘",
                    text: `å½“å‰ç­çº§äººæ•°å°‘äºé€‰æ‹©çš„æŠ½å–äººæ•°ï¼Œè¯·å‡å°‘æŠ½å–äººæ•°ï¼`
                });
                return;
            }

            // ç¦ç”¨æŒ‰é’®
            document.getElementById('rePickButton').disabled = true;

            // ç”Ÿæˆå€™é€‰åå•
            const candidates = shuffleArray([...students]);
            selectedStudents = candidates.slice(0, selectedNumber);

            // å‡†å¤‡åŠ¨ç”»å®¹å™¨
            const container = document.getElementById('multiSlotsContainer');
            container.innerHTML = selectedStudents
                .map(() => `
            <div class="multi-slot-column">
                <div class="multi-slot-container"></div>
            </div>
        `).join('');

            // åˆå§‹åŒ–æ¯ä¸ªåˆ—çš„å†…å®¹
            const allContainers = container.querySelectorAll('.multi-slot-container');
            allContainers.forEach((container, index) => {
                const items = shuffleArray([...candidates]).concat(selectedStudents[index]);
                container.innerHTML = items.map(name =>
                    `<div class="slot-item">${escapeHtml(name)}</div>`
                ).join('');
                container.style.transform = `translateY(-${items.length * 120}px)`;
            });

            // æ‰§è¡ŒåŠ¨ç”»
            multiAnimationLock = true;
            document.getElementById('rePickButton').disabled = true;

            const startTime = Date.now();
            const duration = 2000 + Math.random() * 500;

            const animate = () => {
                const progress = Date.now() - startTime;
                const ratio = Math.min(progress / duration, 1);
                const easing = 1 - Math.pow(1 - ratio, 3);

                allContainers.forEach((container, index) => {
                    const items = container.children;
                    const targetY = -120 * (items.length - 1) * easing;
                    container.style.transform = `translateY(${targetY}px)`;
                });

                if (ratio < 1) {
                    requestAnimationFrame(animate);
                } else {
                    allContainers.forEach((container, index) => {
                        const items = container.children;
                        container.style.transform = `translateY(-${120 * (items.length - 1)}px)`;
                    });

                    // åªä¿ç•™é«˜äº®é€»è¾‘
                    highlightStudents(selectedStudents.map(s => students.indexOf(s)), false);
                    multiAnimationLock = false;
                    document.getElementById('rePickButton').disabled = false;
                }
            };

            requestAnimationFrame(animate);
        }


        function selectNumber(number) {
            selectedNumber = number;
            pickMultiple();
        }

        let currentStudentIndex = -1; // å½“å‰æ˜¾ç¤ºçš„å­¦ç”Ÿç´¢å¼•
        // å…¨å±€å®šä¹‰ handleKeyDown å‡½æ•°
        let handleKeyDown;


        function removeKeyboardListeners() {
            // ç§»é™¤é”®ç›˜äº‹ä»¶ç›‘å¬å™¨
            if (handleKeyDown) {
                document.removeEventListener('keydown', handleKeyDown);
            }
        }

        // ä¿®æ”¹åçš„showModalå‡½æ•°
        function showModal(modalId, message) {
            const modal = document.getElementById(modalId);
            modal.classList.add('show');
            if (message) {
                document.querySelector(`#${modalId} p`).innerHTML = message;
            }
            addKeyboardListeners(modalId);
        }

        // ä¿®æ”¹åçš„closeModalå‡½æ•°
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('show');
            removeKeyboardListeners();
            cancelAnimationFrame(animationFrameId);
            isAnimating = false;
            // æ¸…é™¤æ¥é¾™çŠ¶æ€
            if (modalId === 'dragonModal') {
                setTimeout(function () {
                    document.getElementById('dragonCard').innerText = "è¯·ç‚¹å‡»â€œä¸‹ä¸€ä½â€å¼€å§‹æŠ½é€‰";
                }, 300);
            }
        }


        function showNumberSelection() {
            selectedNumber = 0;
            //document.getElementById('selectedStudents').innerText = '';
            document.getElementById('rePickButton').style.display = 'none';

            // ç¡®ä¿æ˜¾ç¤ºé€‰æ‹©äººæ•°çš„UIå…ƒç´ 
            showNumberSelectionUI();
            showModal('multipleModal');
        }

        // ä½¿ç”¨æ›´ç§‘å­¦çš„ Fisher-Yates æ´—ç‰Œç®—æ³•
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // ä¿®æ”¹æ´—ç‰Œéƒ¨åˆ†

        let currentShuffledStudents = []; // å­˜å‚¨å½“å‰è½®æ¬¡éšæœºæ’åºçš„æ•°ç»„
        let currentIndex = 0;             // å½“å‰æŠ½å–ä½ç½®ç´¢å¼•

        function nextDragonPick() {
            // å½“éœ€è¦å¼€å§‹æ–°è½®æ¬¡æ—¶è‡ªåŠ¨é‡ç½®
            if (currentIndex >= currentShuffledStudents.length) {
                console.log("å·²å¼€å§‹æ–°ä¸€è½®æŠ½é€‰");
                currentShuffledStudents = shuffleArray([...students]);
                console.log(currentShuffledStudents);
                currentIndex = 0;
            }

            const currentStudent = currentShuffledStudents[currentIndex];
            currentIndex++;
            document.getElementById('dragonCard').innerText = currentStudent;
        }

        // ä¿®æ”¹é”®ç›˜äº‹ä»¶ç›‘å¬é€»è¾‘
        function addKeyboardListeners(modalId) {
            removeKeyboardListeners(); // å…ˆç§»é™¤æ—§çš„
            handleKeyDown = function (event) {
                if (event.key === 'Enter' || event.key === 'ArrowDown' || event.key === 'PageDown') {
                    switch (modalId) {
                        case 'oneModal':
                            if (!isAnimating) pickOne();
                            break;
                        case 'multipleModal':
                            pickMultiple();
                            break;
                        case 'seatModal':
                            //console.log('seatModal');
                            randomSeatAssignment(true);
                            break;
                        case 'dragonModal':
                            nextDragonPick(); // ç›´æ¥è°ƒç”¨æ­£å¸¸æŠ½é€‰é€»è¾‘
                            break;
                        // æ–°å¢åº§ä½è®¾ç½®æ¨¡æ€æ¡†çš„é”®ç›˜å“åº”
                        case 'seatSettingModal':
                            //console.log('seatSettingModal');
                            generateSeat(); // å›è½¦ç›´æ¥ç”Ÿæˆåº§ä½
                            break;
                    }
                }
            };
            document.addEventListener('keydown', handleKeyDown);
        }

        // ç¡®ä¿æ¥é¾™å…¥å£å‡½æ•°æ­£ç¡®åˆå§‹åŒ–
        function dragonPick() {
            if (students.length === 0) {
                Swal.fire({
                    icon: "error",
                    title: "å½“å‰æ— å­¦ç”Ÿ",
                    text: "è¯·å…ˆé€‰æ‹©ç­çº§æˆ–å¯¼å…¥åå•"
                });
                return;
            }
            currentShuffledStudents = shuffleArray([...students]);
            currentIndex = 0;
            nextDragonPick();
            showModal('dragonModal');
        }

        // ç§»é™¤åŸæ¥çš„populateDropdownå‡½æ•°ï¼Œæ”¹ä¸ºæ–°çš„å¡«å……å‡½æ•°
        function populateClassModal() {
            const container = document.getElementById('classList');
            container.innerHTML = '';

            for (const className in predefinedClasses) {
                const div = document.createElement('div');
                div.className = 'class-item';
                div.innerText = className;
                div.onclick = () => {
                    changeClass(className);
                    closeModal('classModal');
                };
                container.appendChild(div);
            }
        }

        // æ–°å¢æ˜¾ç¤ºç­çº§æ¨¡æ€æ¡†å‡½æ•°
        function showClassModal() {
            populateClassModal();
            showModal('classModal');
        }
        function changeClass(className) {
            if (predefinedClasses.hasOwnProperty(className)) {
                students = predefinedClasses[className];
                document.getElementById('className').innerText = className;
                updateStudentCount();
                renderStudents();
                // æ·»åŠ æˆåŠŸæç¤º

                const Toast = Swal.mixin({
                    toast: true,
                    position: "top",
                    showConfirmButton: false,
                    timer: 2000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.onmouseenter = Swal.stopTimer;
                        toast.onmouseleave = Swal.resumeTimer;
                    }
                });
                Toast.fire({
                    icon: "success",
                    title: "ç­çº§åˆ‡æ¢æˆåŠŸ"
                });
            } else {
                Swal.fire({
                    icon: "error",
                    title: "ç³»ç»Ÿå†…éƒ¨é”™è¯¯",
                    text: "ç­çº§ä¸å­˜åœ¨,è¯·æ£€æŸ¥ç­çº§æ•°æ®æˆ–è”ç³»ç®¡ç†å‘˜"
                });
            }
        }


        document.addEventListener('DOMContentLoaded', async () => {
            // åŠ è½½é…ç½®æ–‡ä»¶
            /*const config = await window.electronAPI.loadConfig();
            let hasValidConfig = false;

            if (config && config.className && predefinedClasses[config.className]) {
                students = predefinedClasses[config.className];
                document.getElementById('className').innerText = config.className;
                hasValidConfig = true;
            } else {
                // å¦‚æœæ²¡æœ‰æœ‰æ•ˆé…ç½®ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªé¢„å®šä¹‰ç­çº§ä½œä¸ºä¸´æ—¶é»˜è®¤å€¼
                const defaultClass = Object.keys(predefinedClasses)[0] || 'é«˜ä¸€8ç­';
                students = predefinedClasses[defaultClass] || [];
                document.getElementById('className').innerText = defaultClass;
            }

            updateStudentCount();
            renderStudents();

            // å¦‚æœé…ç½®æ— æ•ˆï¼Œæ˜¾ç¤ºç­çº§é€‰æ‹©æ¨¡æ€æ¡†
            if (!hasValidConfig) {
                // å»¶è¿Ÿç¡®ä¿DOMæ¸²æŸ“å®Œæˆ
                setTimeout(() => {
                    showClassModal();
                    Swal.fire({
                        icon: "info",
                        title: "è¯·é€‰æ‹©ç­çº§",
                        text: "æ£€æµ‹åˆ°æ‚¨æ˜¯é¦–æ¬¡ä½¿ç”¨æˆ–é…ç½®ä¸¢å¤±ï¼Œè¯·å…ˆé€‰æ‹©ç­çº§",
                        //confirmButtonColor: "#3085d6"
                        footer: 'å¦‚æ‚¨å¸Œæœ›ç›´æ¥å¯¼å…¥åå•ï¼Œå¯ç›´æ¥å…³é—­é€‰æ‹©ç­çº§çš„å¯¹è¯æ¡†'
                    });
                }, 100);
            }*/
            const config = await window.electronAPI.loadConfig();
            let hasValidConfig = false;

            if (config && config.className && predefinedClasses[config.className]) {
                students = predefinedClasses[config.className];
                document.getElementById('className').innerText = config.className;
                hasValidConfig = true;
                updateStudentCount();
                renderStudents();
            } else {
                // æ¸…ç©ºåŸæœ‰æ•°æ®
                students = [];
                document.getElementById('className').innerText = "æœªé€‰æ‹©ç­çº§";
                updateStudentCount();
                renderStudents();  // æ˜¾ç¤ºæç¤ºä¿¡æ¯

                // æ˜¾ç¤ºæç¤ºå¼¹çª—
                setTimeout(() => {
                    showClassModal();
                    Swal.fire({
                        icon: "info",
                        title: "è¯·é€‰æ‹©ç­çº§æˆ–å¯¼å…¥åå•",
                        text: "æ£€æµ‹åˆ°æ‚¨æ˜¯é¦–æ¬¡ä½¿ç”¨æˆ–é…ç½®ä¸¢å¤±ï¼Œè¯·é€‰æ‹©ç­çº§æˆ–å¯¼å…¥åå•",
                        footer: 'å¦‚æ‚¨å¸Œæœ›ç›´æ¥å¯¼å…¥åå•ï¼Œå¯ç›´æ¥å…³é—­é€‰æ‹©ç­çº§çš„å¯¹è¯æ¡†'
                    });
                }, 100);
            }
        });
        async function changeClass(className) {
            if (predefinedClasses.hasOwnProperty(className)) {
                students = predefinedClasses[className];
                document.getElementById('className').innerText = className;
                updateStudentCount();
                renderStudents();
                // ä¿å­˜é…ç½®
                const success = await window.electronAPI.saveConfig(className);

                const Toast = Swal.mixin({
                    toast: true,
                    position: "top",
                    showConfirmButton: false,
                    timer: 2000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.onmouseenter = Swal.stopTimer;
                        toast.onmouseleave = Swal.resumeTimer;
                    }
                });
                Toast.fire({
                    icon: "success",
                    title: "ç­çº§åˆ‡æ¢æˆåŠŸ"
                });
                // ä¿å­˜é…ç½®
                const result = await window.electronAPI.saveConfig(className);
                if (!result.success) {
                    Swal.fire({
                        icon: "error",
                        title: "ä¿å­˜å¤±è´¥",
                        text: `æ— æ³•ä¿å­˜é…ç½®: ${result.error || 'æœªçŸ¥é”™è¯¯'}`,
                        footer: 'è¯·å°è¯•é•¿æŒ‰æœ¬ç¨‹åºå¿«æ·æ–¹å¼ï¼ˆå³é”®ï¼‰å¹¶é€‰æ‹©ä»¥ç®¡ç†å‘˜èº«ä»½å…è®¸'
                    });
                    return;
                }

                // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
                Toast = Swal.mixin({
                    toast: true,
                    position: "top",
                    showConfirmButton: false,
                    timer: 2000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.onmouseenter = Swal.stopTimer;
                        toast.onmouseleave = Swal.resumeTimer;
                    }
                });

                Toast.fire({
                    icon: "success",
                    title: result.isElevated ?
                        "å·²é€šè¿‡ç®¡ç†å‘˜æƒé™ä¿å­˜é…ç½®" :
                        "é…ç½®ä¿å­˜æˆåŠŸ"
                });
            } else {
                Swal.fire({
                    icon: "error",
                    title: "ç³»ç»Ÿå†…éƒ¨é”™è¯¯",
                    text: "ç­çº§ä¸å­˜åœ¨,è¯·æ£€æŸ¥ç­çº§æ•°æ®æˆ–è”ç³»ç®¡ç†å‘˜"
                });
            }

        }

        // æ–°å¢èœå•åˆ‡æ¢åŠŸèƒ½
        function toggleNavMenu() {
            const menu = document.querySelector('.nav-menu');
            menu.classList.toggle('show');

            // ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•
            if (menu.classList.contains('show')) {
                document.addEventListener('click', closeMenuOnClickOutside);
            } else {
                document.removeEventListener('click', closeMenuOnClickOutside);
            }
        }

        function closeMenuOnClickOutside(event) {
            const menu = document.querySelector('.nav-menu');
            const toggleButton = document.querySelector('.nav-menu-toggle');

            if (!menu.contains(event.target) && !toggleButton.contains(event.target)) {
                menu.classList.remove('show');
                document.removeEventListener('click', closeMenuOnClickOutside);
            }
        }

        // æ–°å¢åº§ä½è®¾ç½®ç›¸å…³å˜é‡
        let currentColumns = 8;
        let currentRows = 1;

        // ä¿®æ”¹åçš„randomSeatAssignmentå‡½æ•°
        function randomSeatAssignment() {
            closeModal("seatModal");
            if (students.length === 0) {
                Swal.fire("");
                Swal.fire({
                    icon: "error",
                    title: "å½“å‰æ— å­¦ç”Ÿ",
                    //confirmButtonColor: "#3085d6",
                    text: `è¯·å¯¼å…¥æˆ–é€‰æ‹©ç­çº§åå•åé‡è¯•`
                });
                return;
            }
            // è®¡ç®—åˆå§‹è¡Œåˆ—
            const minColumns = Math.ceil(students.length / 50); // æ¯è¡Œæœ€å¤š50äºº
            currentColumns = Math.max(8, minColumns);
            currentRows = Math.ceil(students.length / currentColumns);

            document.getElementById('columnValue').textContent = currentColumns;
            document.getElementById('rowValue').textContent = currentRows;
            showModal('seatSettingModal');
        }

        // è°ƒæ•´åˆ—æ•°
        function adjustColumn(delta) {
            currentColumns = Math.max(1, currentColumns + delta);
            currentRows = Math.ceil(students.length / currentColumns);
            updateUIValues();
        }

        // è°ƒæ•´è¡Œæ•°
        function adjustRow(delta) {
            currentRows = Math.max(1, currentRows + delta);
            currentColumns = Math.ceil(students.length / currentRows);
            updateUIValues();
        }

        // æ›´æ–°ç•Œé¢æ•°å€¼
        function updateUIValues() {
            document.getElementById('columnValue').textContent = currentColumns;
            document.getElementById('rowValue').textContent = currentRows;
        }

        // ç”Ÿæˆåº§ä½è¡¨
        function generateSeat() {
            closeModal('seatSettingModal');
            const totalSeats = currentColumns * currentRows;
            if (totalSeats < students.length) {
                Swal.fire({
                    icon: "error",
                    title: "åº§ä½æ•°ä¸è¶³",
                    //confirmButtonColor: "#3085d6",
                    text: `è¯·å¢åŠ è¡Œæˆ–åˆ—åé‡è¯•`
                });
                return;
            }
            const seatTable = document.getElementById('seatTable');
            seatTable.innerHTML = '';

            // åˆ›å»ºè¡¨æ ¼
            for (let i = 0; i < currentRows; i++) {
                const row = document.createElement('tr');
                for (let j = 0; j < currentColumns; j++) {
                    row.appendChild(document.createElement('td'));
                }
                seatTable.appendChild(row);
            }

            // å¡«å……æ•°æ®
            const shuffled = shuffleArray([...students]);
            const cells = seatTable.getElementsByTagName('td');
            for (let i = 0; i < cells.length; i++) {
                cells[i].textContent = i < shuffled.length ? shuffled[i] : '';
            }

            showModal('seatModal');

            //å–æ¶ˆenteré”®ç„¦ç‚¹
            const focusableElements = [
                '[contenteditable]',
                'a[href]',
                'area[href]',
                'button:not([disabled])',
                'input:not([disabled]):not([type="hidden"]):not(.no-focus)',
                'select:not([disabled])',
                'textarea:not([disabled])',
                '[tabindex]:not([tabindex="-1"]):not([disabled])',
                '[contenteditable]'
            ].join(',');
            const allFocusableElements = document.querySelectorAll(focusableElements);
            allFocusableElements.forEach(element => {
                element.blur();
            });
            //document.getElementById('confirmButton').focus();
        }

        function renderStudents() {
            const container = document.getElementById('studentContainer');
            container.innerHTML = '';

            if (students.length === 0) {
                // åˆ›å»ºæç¤ºä¿¡æ¯å…ƒç´ 
                const emptyState = document.createElement('div');
                container.style.display = 'flex';
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
            <div style="text-align:center; color:#666; padding:40px 20px ">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-box" viewBox="0 0 16 16">
  <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5 8 5.961 14.154 3.5zM15 4.239l-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
</svg>
                <h3 style="margin:15px 0">å½“å‰æ— å­¦ç”Ÿåå•</h3>
                <p>è¯·å…ˆé€‰æ‹©ç­çº§æˆ–å¯¼å…¥åå•</p>
            </div>
        `;
                container.appendChild(emptyState);
            } else {
                container.style.display = 'grid';
                students.forEach(student => {
                    const div = document.createElement('div');
                    div.className = 'student-box';
                    div.innerText = student;
                    container.appendChild(div);
                });
            }
        }

        let isAnimating = false; // åŠ¨ç”»çŠ¶æ€é”
        let animationFrameId = null;

        function pickOne() {
            showModal('oneModal');
            if (isAnimating) return;
            if (students.length === 0) {
                Swal.fire({
                    icon: "error",
                    title: "å½“å‰æ— å­¦ç”Ÿ",
                    text: "è¯·å…ˆé€‰æ‹©ç­çº§æˆ–å¯¼å…¥åå•"
                });
                return;
            }

            // ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
            document.getElementById('pickOneButton').disabled = true;
            isAnimating = true;

            const targetIndex = Math.floor(Math.random() * students.length);
            const targetStudent = students[targetIndex];

            // ç”Ÿæˆæ›´å¤šè¿‡æ¸¡é¡¹ï¼ˆ8-12ä¸ªï¼‰è®©åŠ¨ç”»æ›´è‡ªç„¶
            const transitionItems = [];
            const usedIndices = new Set();
            const transitionCount = Math.min(students.length - 1, 12 + Math.floor(Math.random() * 5));

            while (transitionItems.length < transitionCount) {
                const randomIndex = Math.floor(Math.random() * students.length);
                if (!usedIndices.has(randomIndex) && randomIndex !== targetIndex) {
                    transitionItems.push(students[randomIndex]);
                    usedIndices.add(randomIndex);
                }
            }

            // æ·»åŠ ç›®æ ‡é¡¹ä½œä¸ºæœ€åä¸€é¡¹
            transitionItems.push(targetStudent);

            const container = document.querySelector('.slot-container');
            container.innerHTML = transitionItems.map(name =>
                `<div class="slot-item">${escapeHtml(name)}</div>`
            ).join('');

            const itemHeight = 120;
            const totalHeight = transitionItems.length * itemHeight;

            let currentPosition = -totalHeight + itemHeight;
            container.style.transform = `translateY(${currentPosition}px)`;

            // è°ƒæ•´åŠ¨ç”»å‚æ•°ï¼ˆç¼©çŸ­æ€»æ—¶é•¿ï¼‰
            const duration = 1600 + transitionItems.length * 50;
            let startTime = null;

            const animate = (timestamp) => {
                if (!startTime) startTime = timestamp;
                const progress = timestamp - startTime;
                const ratio = Math.min(progress / duration, 1);

                // ä½¿ç”¨äºŒæ¬¡ç¼“åŠ¨å‡½æ•°å®ç°åŒ€å‡é€Ÿ (easeOutQuad)
                const easing = 1 - Math.pow(1 - ratio, 3);

                // è®¡ç®—ç›®æ ‡ä½ç½®
                const targetPosition = -itemHeight * (transitionItems.length - 1) * easing;

                container.style.transform = `translateY(${targetPosition}px)`;

                if (ratio < 1) {
                    requestAnimationFrame(animate);
                } else {
                    // æœ€ç»ˆç²¾ç¡®å¯¹é½
                    container.style.transform = `translateY(${-itemHeight * (transitionItems.length - 1)}px)`;
                    isAnimating = false;
                    document.getElementById('pickOneButton').disabled = false;
                    highlightStudents([targetIndex], false);
                    /*document.getElementById('selectedStudent').innerHTML =
                        `æœ€ç»ˆé€‰ä¸­ï¼š<strong class="names">${targetStudent}</strong>`;*/
                }
            };

            requestAnimationFrame(animate);
        }

        function selectNumber(number) {
            selectedNumber = number;

            // åˆ‡æ¢UIæ˜¾ç¤º
            document.getElementById('numberSelectionUI').style.display = 'none';
            document.getElementById('resultUI').style.display = 'block';
            document.getElementById('selectionCountText').innerHTML =
                `å½“å‰æŠ½å– <strong >${number}äºº</strong>`;

            pickMultiple();
        }

        function showNumberSelection() {
            selectedNumber = 0;

            // é‡ç½®UIçŠ¶æ€
            document.getElementById('numberSelectionUI').style.display = 'block';
            document.getElementById('resultUI').style.display = 'none';
            document.getElementById('multiSlotsContainer').innerHTML = '';
            document.getElementById('rePickButton').disabled = false;

            showModal('multipleModal');
        }
        // åœ¨DOMåŠ è½½æ—¶æ’å…¥èœå•
        document.addEventListener('DOMContentLoaded', () => {
            const navCollapse = document.querySelector('.nav-collapse');
            const menu = document.createElement('div');
            menu.className = 'nav-menu';
            menu.innerHTML = `
        <button onclick="showAboutModal()">å…³äº</button>
        <button onclick="showClassModal()">é€‰æ‹©ç­çº§</button>
        <button onclick="importList()">å¯¼å…¥åå•</button>
    `;
            navCollapse.appendChild(menu);
        });
        //ç¦æ­¢é€‰ä¸­æ–‡æœ¬
        document.onselectstart = function () { return false }

        //Electronåº”ç”¨å…³é—­å¤„ç†
        document.getElementById('minimize-btn').addEventListener('click', () => {
            window.electron.send('window-minimize');
        });
        document.getElementById('minimize-btn-bottom').addEventListener('click', () => {
            window.electron.send('window-minimize');
        });
        document.getElementById('maximize-btn').addEventListener('click', () => {
            window.electron.send('window-maximize');
        });

        document.getElementById('close-btn').addEventListener('click', () => {
            window.electron.send('window-close');
        });

        //å…³äºæ¨¡æ€æ¡†
        function showAboutModal() {
            window.location.href = "about.html";
            //showModal('aboutModal');
        }
        function escapeHtml(unsafe) {
            return unsafe.toString()
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
    <script src="bootstrap.bundle.min.js"></script>
    <script src="sweetalert2@11.js"></script>
</body>

</html>