<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éšæœºç‚¹å</title>
    <link href="bootstrap.min.css" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'HarmonyOS Sans SC';
            src: url('fonts/HarmonyOS Sans SC Thin.ttf') format('truetype');
            font-weight: 100;
            font-style: normal;
        }

        @font-face {
            font-family: 'HarmonyOS Sans SC';
            src: url('fonts/HarmonyOS Sans SC Light.ttf') format('truetype');
            font-weight: 300;
            font-style: normal;
        }

        @font-face {
            font-family: 'HarmonyOS Sans SC';
            src: url('fonts/HarmonyOS Sans SC Regular.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'HarmonyOS Sans SC';
            src: url('fonts/HarmonyOS Sans SC Medium.ttf') format('truetype');
            font-weight: 500;
            font-style: normal;
        }

        @font-face {
            font-family: 'HarmonyOS Sans SC';
            src: url('fonts/HarmonyOS Sans SC Bold.ttf') format('truetype');
            font-weight: 700;
            font-style: normal;
        }

        @font-face {
            font-family: 'HarmonyOS Sans SC';
            src: url('fonts/HarmonyOS Sans SC Black.ttf') format('truetype');
            font-weight: 900;
            font-style: normal;
        }

        html {
            font-family: 'HarmonyOS Sans', sans-serif;
        }

        body {
            margin: 0;
            font-family: 'HarmonyOS Sans', sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #0d47a1;
            color: white;
            padding: 0 20px;
            height: 60px;
        }

        .navbar h1 {
            margin: 0;
            font-size: 24px;
            font-family: 'HarmonyOS Sans', sans-serif;
        }

        .navbar .class-info {
            font-size: 18px;
        }

        .navbar button {
            width: 120px;
            height: 40px;
            cursor: pointer;
            margin-left: 10px;
        }

        .main-container {
            flex: 1;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            padding: 10px;
            background-color: #f0f0f0;
        }

        .student-box {
            width: 100px;
            height: 50px;
            background-color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 1px 1px 1px 1px rgb(196 196 196 / 20%);
            overflow: hidden;
            /* éšè—æº¢å‡ºçš„å†…å®¹ */
        }

        .highlight {
            background-color: #ffc107;
        }

        .bottom-buttons {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: #ffffff;

        }

        .bottom-buttons button {
            border: none;
            cursor: pointer;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            position: relative;
            margin: 5em;
        }

        .modal-content button {
            margin-top: 10px;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 20px;
        }



        .names {
            font-size: 2em;
        }

        .number-button {
            width: 2.2em;
            height: 2.2em;
            font-size: 2rem;
            margin: 8px;
            border-radius: 50%;
            --bs-btn-padding-x: 0;
            --bs-btn-padding-y: 0;
        }

        .hidden {
            display: none;
        }

        #dragonCards {
            font-size: 2em;
        }

        /* è®¾ç½®è¡¨æ ¼è¾¹æ¡† */
        table,
        th,
        td {
            border: 1.5px solid #484848;
        }

        /* è®¾ç½®è¡¨æ ¼å®½åº¦ä¸º100%ï¼Œå¹¶ä¸”ä½¿è¾¹æ¡†åˆå¹¶ */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        /* è®¾ç½®è¡¨å¤´å’Œå•å…ƒæ ¼çš„å†…è¾¹è· */
        th,
        td {
            padding: 12px;
            text-align: center;
            font-size: 1.3em;
        }

        .navbar {
            -webkit-app-region: drag;
            /* è®©å¯¼èˆªæ å¯æ‹–åŠ¨ */
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #0d47a1;
            color: white;
            padding: 0 20px;
            height: 60px;
        }

        /*ä¾›electronå®Œæˆæ‹–åŠ¨é€»è¾‘*/
        .navbar button {
            -webkit-app-region: no-drag;
            /* æŒ‰é’®ä¸å¯æ‹–åŠ¨ */
            cursor: pointer;
            border-radius: 10px;
        }

        .window-controls {
            display: flex;
            gap: 10px;
        }

        .window-controls button {
            background: rgba(0, 0, 0, 0);
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        .controlbutton {
            border-radius: 5px;
        }

        .window-controls button {
            height: 35px;
            width: 35px;
        }

        #dragonCard {
            margin: 10px 0;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            text-align: center;
            opacity: 1;
            font-size: 2em;
            font-weight: bolder;
        }

        /* æ–°å¢ç­çº§åˆ—è¡¨æ ·å¼ */
        .class-list-container {
            max-height: 60vh;
            overflow-y: auto;
            margin: 20px 0;
        }

        .class-item {
            padding: 12px;
            margin: 5px 0;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        /* ç½‘æ ¼å¸ƒå±€æ ·å¼ */
        .class-list-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            max-height: 60vh;
            overflow-y: auto;
            padding: 10px;
            width: 80vw;
            /* æ§åˆ¶æ¨¡æ€æ¡†å®½åº¦ */
        }

        .class-item {
            width: 100px;
            height: 50px;
            background-color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 1px 1px 1px 1px rgb(196 196 196 / 20%);
            cursor: pointer;
            transition: all 0.2s;
            padding: 5px;
            text-align: center;
            word-break: break-all;
            /* é•¿ç­çº§åè‡ªåŠ¨æ¢è¡Œ */
        }

        /* æ–°å¢åŠ¨ç”»ç›¸å…³æ ·å¼ */
        .modal {
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            transform: translateY(-50px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .modal.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }


        /* å…³é—­æ—¶åå‘åŠ¨ç”» */
        .modal:not(.show) .modal-content {
            transition: all 0.2s ease-out;
        }

        /* æ–°å¢åª’ä½“æŸ¥è¯¢ */
        @media (max-width: 960px) {
            .navbar {
                flex-wrap: wrap;
                height: auto;
                padding: 10px;
            }

            .navbar h1 {
                font-size: 1.2rem;
                margin-bottom: 8px;
            }

            .class-info {
                order: 3;
                width: 100%;
                text-align: center;
                font-size: 0.9rem;
                margin-top: 8px;
            }

            .navbar>button {
                width: auto;
                padding: 0 8px;
                font-size: 0.8rem;
                height: 32px;
                margin: 2px;
            }

            .window-controls button {
                width: 28px;
                height: 28px;
            }

            .bottom-buttons {
                flex-wrap: wrap;
                height: auto;
                padding: 8px;
            }

            .bottom-buttons button {
                width: 48%;
                margin: 4px 1%;
                font-size: 0.9rem;
                padding: 8px;
            }
        }

        @media (max-width: 576px) {
            .navbar>button {
                font-size: 0.7rem;
                padding: 0 4px;
            }

            .bottom-buttons button {
                width: 100%;
                margin: 4px 0;
            }

            .main-container {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }

            .student-box {
                width: 80px;
                height: 40px;
                font-size: 0.8rem;
            }
        }

        /* ä¿®æ”¹ç°æœ‰æ ·å¼ */
        .navbar {
            gap: 8px;
            /* æ·»åŠ é—´è· */
            padding: 0 10px;
        }

        .navbar>button {
            min-width: 80px;
            /* æ›¿ä»£å›ºå®šå®½åº¦ */
            width: auto;
            padding: 3px 8px 3px;
            white-space: nowrap;
            /* é˜²æ­¢æŒ‰é’®æ–‡å­—æ¢è¡Œ */
        }

        .bottom-buttons {
            gap: 8px;
            padding: 10px;
        }

        .window-controls {
            flex-shrink: 0;
            /* é˜²æ­¢çª—å£æ§åˆ¶æŒ‰é’®è¢«å‹ç¼© */
        }

        /* æ–°å¢æŠ˜å èœå•æ ·å¼ */
        .nav-collapse {
            position: relative;
            display: flex;
            align-items: center;
        }

        .nav-menu-toggle {
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            min-width: 160px;
            z-index: 1000;
            display: none;
        }

        .nav-menu.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .nav-menu button {
            width: 100%;
            text-align: left;
            padding: 8px 16px;
            border: none;
            background: none;
            border-radius: 0;

        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ä¿®æ”¹åŸæœ‰åª’ä½“æŸ¥è¯¢ */
        @media (max-width: 700px) {
            .class-info {
                order: 3;
                width: 100%;
                text-align: center;
                font-size: 0.9rem;
                margin-top: 8px;
            }

            .nav-buttons {
                display: none !important;
            }

            .nav-menu-toggle {
                display: flex !important;
            }
        }

        @media (min-width: 700px) {
            .nav-menu {
                display: none !important;
            }
        }

        /* æ–°å¢é¢œè‰²å˜é‡ */
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --accent-color: #4895ef;
            --background: #f8f9fa;
            --text-primary: #2b2d42;
            --text-secondary: #8d99ae;
        }

        /* æ•´ä½“èƒŒæ™¯å’Œå­—ä½“ä¼˜åŒ– */
        body {
            background: var(--background);
            color: var(--text-primary);

        }

        /* å¯¼èˆªæ ç°ä»£åŒ–æ”¹é€  */
        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);

            padding: 0 2rem;
        }

        .navbar h1 {
            font-weight: 700;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* ä¸»å†…å®¹åŒºå¡ç‰‡æ ·å¼ */
        .main-container {
            background: transparent;
            padding: 1.5rem;
            gap: 1.2rem;
        }

        .student-box {
            background: white;
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.2s ease;
            height: 50px;
            font-size: 1rem;
        }

        .highlight {
            background: var(--accent-color) !important;
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        /* åº•éƒ¨æŒ‰é’®ç»„ä¼˜åŒ– */
        .bottom-buttons {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            gap: 1rem;
        }

        .bottom-buttons button {
            border-radius: 10px;
            padding: 0.8rem 1.5rem;
            font-weight: 500;
            transition: all 0.2s ease;
            min-width: 140px;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        /* æ¨¡æ€æ¡†ç°ä»£åŒ– */
        .modal-content {
            border-radius: 15px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            border: none;
            padding: 1.5rem;
        }

        .modal-content h3 {
            color: var(--text-primary);
            margin-bottom: 1.5rem;
        }

        .close-btn {
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }


        /* è¡¨æ ¼ä¼˜åŒ– */
        table {
            border-radius: 12px;
            overflow: hidden;
            background: white;
        }

        th {
            background: var(--primary-color);
            color: white !important;
            font-weight: 600;
        }

        td {
            background: rgba(237, 237, 238, 0.8);
        }

        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 768px) {
            .navbar {
                padding: 0 1rem;
                height: 60px;
            }

            .navbar h1 {
                font-size: 1.4rem;
            }

            .student-box {
                height: 60px;
                font-size: 1rem;
            }

            .bottom-buttons button {
                width: 100%;
                padding: 0.8rem;
                font-size: 0.95rem;
            }
        }

        /* çª—å£æ§åˆ¶æŒ‰é’®ç¾åŒ– */
        .window-controls button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        /* æ–°å¢æ•°å­—é€‰æ‹©å™¨æ ·å¼ */
        .number-picker {
            text-align: center;
            padding: 0 20px;
        }

        .rounded-circle {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: 2px solid #4361ee;
            color: #4361ee;
            transition: all 0.2s;
        }
    </style>
</head>

<body>
    <div class="navbar">
        <div class="d-flex align-items-center gap-3">
            <h1 style="color: white;">ğŸ¯ éšæœºç‚¹å</h1>
            <div class="class-info text-light opacity-85">
                <span id="className">é«˜ä¸€8ç­</span>
                <span class="mx-2">|</span>
                <span id="studentCount">0äºº</span>
            </div>
        </div>
        <!-- æ–°å¢æŠ˜å èœå• -->
        <div class="nav-collapse">
            <!-- åŸæœ‰æŒ‰é’®ç»„ -->
            <div class="nav-buttons d-none d-md-flex">
                <button onclick="showAboutModal()" class="btn btn-info">å…³äº</button>
                <button onclick="showClassModal()" class="btn btn-info">é€‰æ‹©ç­çº§</button>
                <button onclick="importList()" class="btn btn-info">å¯¼å…¥åå•</button>
            </div>

            <!-- æŠ˜å èœå•æŒ‰é’® -->
            <button class="nav-menu-toggle btn btn-info d-md-none toggleNavMenu" onclick="toggleNavMenu()">
                è®¾ç½®
            </button>
        </div>

        <div class="window-controls d-flex align-items-center gap-2">
            <button class="controlbutton" id="minimize-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                    height="16" fill="currentColor" class="bi bi-dash-lg" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2 8a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11A.5.5 0 0 1 2 8Z" />
                </svg></button> <!-- æœ€å°åŒ–æŒ‰é’® -->
            <button class="controlbutton" id="maximize-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                    height="16" fill="currentColor" class="bi bi-square" viewBox="0 0 16 16">
                    <path
                        d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z" />
                </svg></button> <!-- æœ€å¤§åŒ–æŒ‰é’® -->
            <button class="controlbutton" id="close-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                    fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                    <path
                        d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z" />
                </svg></button> <!-- å…³é—­æŒ‰é’® -->
        </div>
    </div>
    <div class="main-container" id="studentContainer"></div>
    <div class="bottom-buttons">
        <button onclick="pickOne()" class="btn btn-lg btn-primary col-12 col-sm-auto">æŠ½å–ä¸€äºº</button>
        <button onclick="showNumberSelection()" class="btn btn-lg btn-success col-12 col-sm-auto">æŠ½å–å¤šäºº</button>
        <button onclick="dragonPick()" class="btn btn-lg btn-warning col-12 col-sm-auto">æ¥é¾™æŠ½é€‰</button>
        <button onclick="randomSeatAssignment()" class="btn btn-lg btn-info col-12 col-sm-auto">éšæœºé€‰åº§</button>
    </div>
    <!-- æ¨¡æ€æ¡†æ¨¡æ¿ -->
    <div id="seatModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('seatModal')">&times;</span>
            <h3 style="font-weight: bolder;">åº§ä½å®‰æ’</h3>
            <table id="seatTable" border="1" cellpadding="5" cellspacing="0"></table>
            <div style="margin-top: 10px; text-align: center;">
                <button onclick="randomSeatAssignment(true)" class="btn btn-primary">é‡æ–°åˆ†é…</button>
            </div>
        </div>
    </div>
    <!-- æ¨¡æ€æ¡†æ¨¡æ¿ -->
    <div id="oneModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('oneModal')">&times;</span>
            <p id="selectedStudent"></p>
            <button onclick="pickOne()" class="btn btn-primary">æ¢ä¸€äºº</button>
        </div>
    </div>
    <div id="multipleModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('multipleModal')">&times;</span>
            <p>è¯·é€‰æ‹©æŠ½å–äººæ•°ï¼š</p>
            <div>
                <button onclick="selectNumber(1)" class="btn btn-primary number-button">1</button>
                <button onclick="selectNumber(2)" class="btn btn-primary  number-button">2</button>
                <button onclick="selectNumber(3)" class="btn btn-primary  number-button">3</button>
                <button onclick="selectNumber(4)" class="btn btn-primary  number-button">4</button>
                <button onclick="selectNumber(5)" class="btn btn-primary  number-button">5</button>
                <button onclick="selectNumber(6)" class="btn btn-primary  number-button">6</button>
            </div>
            <p id="selectedStudents"></p>
            <button onclick="pickMultiple()" id="rePickButton" class="btn btn-primary">æ¢ä¸€ç»„</button>
        </div>
    </div>
    <div id="dragonModal" class="modal">
        <div class="modal-content roster-modal">
            <span class="close-btn" onclick="closeModal('dragonModal')">&times;</span>
            <div id="dragonCard" class="card">è¯·ç‚¹å‡»â€œä¸‹ä¸€ä½â€å¼€å§‹æŠ½é€‰</div>
            <button onclick="nextDragonPick()" class="btn btn-primary">ä¸‹ä¸€ä½</button>
        </div>
    </div>
    <!-- æ–°å¢ç­çº§é€‰æ‹©æ¨¡æ€æ¡† -->
    <div id="classModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('classModal')">&times;</span>
            <h3 style="font-weight: bolder;">è¯·é€‰æ‹©ç­çº§</h3>
            <div id="classList" class="class-list-container"></div>
        </div>
    </div>
    <div id="seatSettingModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('seatSettingModal')">&times;</span>
            <h3 style="font-weight: bolder;">åº§ä½è®¾ç½®</h3>
            <div class="d-flex justify-content-around my-4">
                <!-- åˆ—æ•°é€‰æ‹©å™¨ -->
                <div class="number-picker">
                    <div class="text-center mb-2">åˆ—æ•°</div>
                    <div class="d-flex align-items-center">
                        <button class="btn btn-primary rounded-circle px-3 py-1" onclick="adjustColumn(-1)">-</button>
                        <span id="columnValue" class="mx-3 fs-4">8</span>
                        <button class="btn btn-primary rounded-circle px-3 py-1" onclick="adjustColumn(1)">+</button>
                    </div>
                </div>
                <!-- è¡Œæ•°é€‰æ‹©å™¨ -->
                <div class="number-picker">
                    <div class="text-center mb-2">è¡Œæ•°</div>
                    <div class="d-flex align-items-center">
                        <button class="btn btn-primary rounded-circle px-3 py-1" onclick="adjustRow(-1)">-</button>
                        <span id="rowValue" class="mx-3 fs-4">1</span>
                        <button class="btn btn-primary rounded-circle px-3 py-1" onclick="adjustRow(1)">+</button>
                    </div>
                </div>
            </div>
            <div class="text-center mt-3">
                <button onclick="generateSeat()" class="btn btn-primary">ç¡®å®š</button>
            </div>
        </div>
    </div>
    <script src="sheet.js"></script>
    <script>
        let students = [];
        let selectedNumber = 0;
        let selectedStudents = [];

        function importList() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt';
            input.onchange = function (e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const lines = event.target.result.split('\n').filter(line => line.trim());
                        if (lines.length === 0) {
                            Swal.fire({
                                icon: "error",
                                title: "æ–‡ä»¶æ ¼å¼é”™è¯¯",
                                confirmButtonColor: "#3085d6",
                                text: "å¯¼å…¥çš„åå•æ–‡ä»¶ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥åé‡æ–°ä¸Šä¼ ï¼"
                            });
                            return;
                        }
                        students = lines;
                        const className = file.name.split('.').slice(0, -1).join('.');
                        document.getElementById('className').innerText = className;
                        updateStudentCount();
                        renderStudents();
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function updateStudentCount() {
            document.getElementById('studentCount').innerText = `${students.length}äºº`;
        }

        function renderStudents() {
            const container = document.getElementById('studentContainer');
            container.innerHTML = '';
            students.forEach(student => {
                const div = document.createElement('div');
                div.className = 'student-box';
                div.innerText = student;
                container.appendChild(div);
            });
        }

        function highlightStudents(indices, clearAll) {
            const boxes = document.querySelectorAll('.student-box');
            boxes.forEach((box, index) => {
                box.classList.remove('highlight');
                if (!clearAll && indices.includes(index)) {
                    box.classList.add('highlight');
                }
            });
        }

        // éšè—é€‰æ‹©äººæ•°çš„UIå…ƒç´ çš„æ–¹æ³•
        function hideNumberSelectionUI() {
            document.querySelector('#multipleModal p:first-of-type').classList.add('hidden'); // éšè—æç¤ºæ–‡æ¡ˆ
            document.querySelectorAll('.number-button').forEach(button => button.classList.add('hidden')); // éšè—æŒ‰é’®
        }

        // æ˜¾ç¤ºé€‰æ‹©äººæ•°çš„UIå…ƒç´ çš„æ–¹æ³•
        function showNumberSelectionUI() {
            document.querySelector('#multipleModal p:first-of-type').classList.remove('hidden'); // æ˜¾ç¤ºæç¤ºæ–‡æ¡ˆ
            document.querySelectorAll('.number-button').forEach(button => button.classList.remove('hidden')); // æ˜¾ç¤ºæŒ‰é’®
        }

        function pickMultiple() {
            if (students.length < selectedNumber) {
                Swal.fire({
                    icon: "error",
                    title: "äººæ•°è¿‡å°‘",
                    confirmButtonColor: "#3085d6",
                    text: `å½“å‰ç­çº§äººæ•°å°‘äºé€‰æ‹©çš„æŠ½å–äººæ•°ï¼Œè¯·å‡å°‘æŠ½å–äººæ•°ï¼`
                });
                return;
            }
            if (selectedNumber > 0) {
                let selectedIndices = new Set(); // ä½¿ç”¨Setæ¥ä¿è¯å”¯ä¸€æ€§

                while (selectedIndices.size < selectedNumber) {
                    const randomIndex = Math.floor(Math.random() * students.length);
                    selectedIndices.add(randomIndex); // è‡ªåŠ¨å¿½ç•¥å·²ç»å­˜åœ¨çš„ç´¢å¼•
                }

                // å°†Setè½¬æ¢ä¸ºArrayå¹¶è·å–å¯¹åº”çš„å­¦ç”Ÿåå­—
                const selectedNames = Array.from(selectedIndices).map(i => students[i]).join(' ');
                //document.getElementById('selectedStudents').innerHTML = `è¢«é€‰ä¸­çš„åŒå­¦æ˜¯ï¼š<br><strong class="names">${selectedNames}</strong>`;
                const container = document.getElementById('selectedStudents');
                container.innerHTML = 'è¢«é€‰ä¸­çš„åŒå­¦æ˜¯ï¼š<br><strong class="names"></strong>';  // é™æ€HTML
                container.querySelector('.names').textContent = selectedNames;  // å®‰å…¨æ’å…¥å†…å®¹

                document.getElementById('rePickButton').style.display = 'block';
                hideNumberSelectionUI();
            }
        }

        function selectNumber(number) {
            selectedNumber = number;
            pickMultiple();
        }

        let currentStudentIndex = -1; // å½“å‰æ˜¾ç¤ºçš„å­¦ç”Ÿç´¢å¼•
        // å…¨å±€å®šä¹‰ handleKeyDown å‡½æ•°
        let handleKeyDown;


        function removeKeyboardListeners() {
            // ç§»é™¤é”®ç›˜äº‹ä»¶ç›‘å¬å™¨
            if (handleKeyDown) {
                document.removeEventListener('keydown', handleKeyDown);
            }
        }

        // ä¿®æ”¹åçš„showModalå‡½æ•°
        function showModal(modalId, message) {
            const modal = document.getElementById(modalId);
            modal.classList.add('show');
            if (message) {
                document.querySelector(`#${modalId} p`).innerHTML = message;
            }
            addKeyboardListeners(modalId);
        }

        // ä¿®æ”¹åçš„closeModalå‡½æ•°
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('show');
            removeKeyboardListeners();

            // æ¸…é™¤æ¥é¾™çŠ¶æ€
            if (modalId === 'dragonModal') {
                setTimeout(function () {
                    document.getElementById('dragonCard').innerText = "è¯·ç‚¹å‡»â€œä¸‹ä¸€ä½â€å¼€å§‹æŠ½é€‰";
                }, 300);
            }
        }

        function pickOne() {
            closeModal('oneModal');
            highlightStudents([], true);
            const randomIndex = Math.floor(Math.random() * students.length);
            highlightStudents([randomIndex], false);
            //showModal('oneModal', `è¢«é€‰ä¸­çš„åŒå­¦æ˜¯ï¼š<br><strong class="names">${students[randomIndex]}</strong>`);
            const modal = document.getElementById('oneModal');
            modal.querySelector('p').innerHTML = 'è¢«é€‰ä¸­çš„åŒå­¦æ˜¯ï¼š<br><strong class="names"></strong>';
            modal.querySelector('.names').textContent = students[randomIndex];
            showModal('oneModal');
        }
        function showNumberSelection() {
            selectedNumber = 0;
            document.getElementById('selectedStudents').innerText = '';
            document.getElementById('rePickButton').style.display = 'none';

            // ç¡®ä¿æ˜¾ç¤ºé€‰æ‹©äººæ•°çš„UIå…ƒç´ 
            showNumberSelectionUI();
            showModal('multipleModal');
        }

        /*function randomSeatAssignment(refresh) {
            if (students.length > 200) {
                Swal.fire({
                    icon: "error",
                    title: "äººæ•°è¿‡å¤š",
                    confirmButtonColor: "#3085d6",
                    text: "è¯·ç¡®è®¤äººæ•°å°‘äº200äººåå†ä½¿ç”¨éšæœºé€‰åº§åŠŸèƒ½ï¼"
                });
                return;
            } else {
                const seatTable = document.getElementById('seatTable');
                const columns = 8;
                let rowsNeeded = Math.ceil(students.length / columns);

                if (refresh || !seatTable.innerHTML.trim()) {
                    seatTable.innerHTML = '';

                    for (let row = 0; row < rowsNeeded; row++) {
                        let tableRow = '<tr>';
                        for (let col = 0; col < columns; col++) {
                            tableRow += `<td></td>`;
                        }
                        tableRow += '</tr>';
                        seatTable.innerHTML += tableRow;
                    }

                    // ä¿®æ”¹åçš„æ´—ç‰Œé€»è¾‘
                    let shuffledStudents = shuffleArray([...students]);

                    let index = 0;
                    const cells = seatTable.getElementsByTagName('td');
                    for (let i = 0; i < cells.length && index < students.length; i++) {
                        if (cells[i]) {
                            cells[i].innerText = shuffledStudents[index++];
                        }
                    }
                }

                if (!refresh) {
                    showModal('seatModal');
                }
            }
        }*/

        // ä½¿ç”¨æ›´ç§‘å­¦çš„ Fisher-Yates æ´—ç‰Œç®—æ³•
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // ä¿®æ”¹æ´—ç‰Œéƒ¨åˆ†

        let currentShuffledStudents = []; // å­˜å‚¨å½“å‰è½®æ¬¡éšæœºæ’åºçš„æ•°ç»„
        let currentIndex = 0;             // å½“å‰æŠ½å–ä½ç½®ç´¢å¼•

        function nextDragonPick() {
            // å½“éœ€è¦å¼€å§‹æ–°è½®æ¬¡æ—¶è‡ªåŠ¨é‡ç½®
            if (currentIndex >= currentShuffledStudents.length) {
                console.log("å·²å¼€å§‹æ–°ä¸€è½®æŠ½é€‰");
                currentShuffledStudents = shuffleArray([...students]);
                console.log(currentShuffledStudents);
                currentIndex = 0;
            }

            const currentStudent = currentShuffledStudents[currentIndex];
            currentIndex++;
            document.getElementById('dragonCard').innerText = currentStudent;
        }

        // ä¿®æ”¹é”®ç›˜äº‹ä»¶ç›‘å¬é€»è¾‘
        function addKeyboardListeners(modalId) {
            removeKeyboardListeners(); // å…ˆç§»é™¤æ—§çš„
            handleKeyDown = function (event) {
                if (event.key === 'Enter' || event.key === 'ArrowDown' || event.key === 'PageDown') {
                    switch (modalId) {
                        case 'oneModal':
                            pickOne();
                            break;
                        case 'multipleModal':
                            pickMultiple();
                            break;
                        case 'seatModal':
                            randomSeatAssignment(true);
                            break;
                        case 'dragonModal':
                            nextDragonPick(); // ç›´æ¥è°ƒç”¨æ­£å¸¸æŠ½é€‰é€»è¾‘
                            break;
                    }
                }
            };
            document.addEventListener('keydown', handleKeyDown);
        }

        // ç¡®ä¿æ¥é¾™å…¥å£å‡½æ•°æ­£ç¡®åˆå§‹åŒ–
        function dragonPick() {
            currentShuffledStudents = shuffleArray([...students]);
            currentIndex = 0;
            nextDragonPick();
            showModal('dragonModal');
        }

        // ç§»é™¤åŸæ¥çš„populateDropdownå‡½æ•°ï¼Œæ”¹ä¸ºæ–°çš„å¡«å……å‡½æ•°
        function populateClassModal() {
            const container = document.getElementById('classList');
            container.innerHTML = '';

            for (const className in predefinedClasses) {
                const div = document.createElement('div');
                div.className = 'class-item';
                div.innerText = className;
                div.onclick = () => {
                    changeClass(className);
                    closeModal('classModal');
                };
                container.appendChild(div);
            }
        }

        // æ–°å¢æ˜¾ç¤ºç­çº§æ¨¡æ€æ¡†å‡½æ•°
        function showClassModal() {
            populateClassModal();
            showModal('classModal');
        }
        function changeClass(className) {
            if (predefinedClasses.hasOwnProperty(className)) {
                students = predefinedClasses[className];
                document.getElementById('className').innerText = className;
                updateStudentCount();
                renderStudents();
                // æ·»åŠ æˆåŠŸæç¤º

                const Toast = Swal.mixin({
                    toast: true,
                    position: "top",
                    showConfirmButton: false,
                    timer: 2000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.onmouseenter = Swal.stopTimer;
                        toast.onmouseleave = Swal.resumeTimer;
                    }
                });
                Toast.fire({
                    icon: "success",
                    title: "ç­çº§åˆ‡æ¢æˆåŠŸ"
                });
            } else {
                Swal.fire({
                    icon: "error",
                    title: "ç³»ç»Ÿå†…éƒ¨é”™è¯¯",
                    text: "ç­çº§ä¸å­˜åœ¨,è¯·æ£€æŸ¥ç­çº§æ•°æ®æˆ–è”ç³»ç®¡ç†å‘˜"
                });
            }
        }


        document.addEventListener('DOMContentLoaded', async () => {
            // åŠ è½½é…ç½®æ–‡ä»¶
            const config = await window.electronAPI.loadConfig();
            let hasValidConfig = false;

            if (config && config.className && predefinedClasses[config.className]) {
                students = predefinedClasses[config.className];
                document.getElementById('className').innerText = config.className;
                hasValidConfig = true;
            } else {
                // å¦‚æœæ²¡æœ‰æœ‰æ•ˆé…ç½®ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªé¢„å®šä¹‰ç­çº§ä½œä¸ºä¸´æ—¶é»˜è®¤å€¼
                const defaultClass = Object.keys(predefinedClasses)[0] || 'é«˜ä¸€8ç­';
                students = predefinedClasses[defaultClass] || [];
                document.getElementById('className').innerText = defaultClass;
            }

            updateStudentCount();
            renderStudents();

            // å¦‚æœé…ç½®æ— æ•ˆï¼Œæ˜¾ç¤ºç­çº§é€‰æ‹©æ¨¡æ€æ¡†
            if (!hasValidConfig) {
                // å»¶è¿Ÿç¡®ä¿DOMæ¸²æŸ“å®Œæˆ
                setTimeout(() => {
                    showClassModal();
                    Swal.fire({
                        icon: "info",
                        title: "è¯·é€‰æ‹©ç­çº§",
                        text: "æ£€æµ‹åˆ°æ‚¨æ˜¯é¦–æ¬¡ä½¿ç”¨æˆ–é…ç½®ä¸¢å¤±ï¼Œè¯·å…ˆé€‰æ‹©ç­çº§ï¼ˆæ³¨ï¼šå¦‚æ‚¨å¸Œæœ›ç›´æ¥å¯¼å…¥åå•ï¼Œå¯ç›´æ¥å…³é—­é€‰æ‹©ç­çº§çš„å¯¹è¯æ¡†ï¼‰",
                        confirmButtonColor: "#3085d6"
                    });
                }, 100);
            }
        });
        async function changeClass(className) {
            if (predefinedClasses.hasOwnProperty(className)) {
                students = predefinedClasses[className];
                document.getElementById('className').innerText = className;
                updateStudentCount();
                renderStudents();
                // ä¿å­˜é…ç½®
                const success = await window.electronAPI.saveConfig(className);

                const Toast = Swal.mixin({
                    toast: true,
                    position: "top",
                    showConfirmButton: false,
                    timer: 2000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.onmouseenter = Swal.stopTimer;
                        toast.onmouseleave = Swal.resumeTimer;
                    }
                });
                Toast.fire({
                    icon: "success",
                    title: "ç­çº§åˆ‡æ¢æˆåŠŸ"
                });
                // ä¿å­˜é…ç½®
                const result = await window.electronAPI.saveConfig(className);
                if (!result.success) {
                    Swal.fire({
                        icon: "error",
                        title: "ä¿å­˜å¤±è´¥",
                        text: `æ— æ³•ä¿å­˜é…ç½®: ${result.error || 'æœªçŸ¥é”™è¯¯'}`
                    });
                    return;
                }

                // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
                Toast = Swal.mixin({
                    toast: true,
                    position: "top",
                    showConfirmButton: false,
                    timer: 2000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.onmouseenter = Swal.stopTimer;
                        toast.onmouseleave = Swal.resumeTimer;
                    }
                });

                Toast.fire({
                    icon: "success",
                    title: result.isElevated ?
                        "å·²é€šè¿‡ç®¡ç†å‘˜æƒé™ä¿å­˜é…ç½®" :
                        "é…ç½®ä¿å­˜æˆåŠŸ"
                });
            } else {
                Swal.fire({
                    icon: "error",
                    title: "ç³»ç»Ÿå†…éƒ¨é”™è¯¯",
                    text: "ç­çº§ä¸å­˜åœ¨,è¯·æ£€æŸ¥ç­çº§æ•°æ®æˆ–è”ç³»ç®¡ç†å‘˜"
                });
            }

        }

        // æ–°å¢èœå•åˆ‡æ¢åŠŸèƒ½
        function toggleNavMenu() {
            const menu = document.querySelector('.nav-menu');
            menu.classList.toggle('show');

            // ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•
            if (menu.classList.contains('show')) {
                document.addEventListener('click', closeMenuOnClickOutside);
            } else {
                document.removeEventListener('click', closeMenuOnClickOutside);
            }
        }

        function closeMenuOnClickOutside(event) {
            const menu = document.querySelector('.nav-menu');
            const toggleButton = document.querySelector('.nav-menu-toggle');

            if (!menu.contains(event.target) && !toggleButton.contains(event.target)) {
                menu.classList.remove('show');
                document.removeEventListener('click', closeMenuOnClickOutside);
            }
        }

        // æ–°å¢åº§ä½è®¾ç½®ç›¸å…³å˜é‡
        let currentColumns = 8;
        let currentRows = 1;

        // ä¿®æ”¹åçš„randomSeatAssignmentå‡½æ•°
        function randomSeatAssignment() {
            if (students.length === 0) {
                Swal.fire("è¯·å…ˆå¯¼å…¥æˆ–é€‰æ‹©ç­çº§åå•");
                return;
            }
            // è®¡ç®—åˆå§‹è¡Œåˆ—
            const minColumns = Math.ceil(students.length / 50); // æ¯è¡Œæœ€å¤š50äºº
            currentColumns = Math.max(8, minColumns);
            currentRows = Math.ceil(students.length / currentColumns);

            document.getElementById('columnValue').textContent = currentColumns;
            document.getElementById('rowValue').textContent = currentRows;
            showModal('seatSettingModal');
        }

        // è°ƒæ•´åˆ—æ•°
        function adjustColumn(delta) {
            currentColumns = Math.max(1, currentColumns + delta);
            currentRows = Math.ceil(students.length / currentColumns);
            updateUIValues();
        }

        // è°ƒæ•´è¡Œæ•°
        function adjustRow(delta) {
            currentRows = Math.max(1, currentRows + delta);
            currentColumns = Math.ceil(students.length / currentRows);
            updateUIValues();
        }

        // æ›´æ–°ç•Œé¢æ•°å€¼
        function updateUIValues() {
            document.getElementById('columnValue').textContent = currentColumns;
            document.getElementById('rowValue').textContent = currentRows;
        }

        // ç”Ÿæˆåº§ä½è¡¨
        function generateSeat() {
            closeModal('seatSettingModal');
            const totalSeats = currentColumns * currentRows;
            if (totalSeats < students.length) {
                Swal.fire({
                    icon: "error",
                    title: "åº§ä½æ•°ä¸è¶³",
                    confirmButtonColor: "#3085d6",
                    text: `è¯·å¢åŠ è¡Œæˆ–åˆ—åé‡è¯•`
                });
                return;
            }
            const seatTable = document.getElementById('seatTable');
            seatTable.innerHTML = '';

            // åˆ›å»ºè¡¨æ ¼
            for (let i = 0; i < currentRows; i++) {
                const row = document.createElement('tr');
                for (let j = 0; j < currentColumns; j++) {
                    row.appendChild(document.createElement('td'));
                }
                seatTable.appendChild(row);
            }

            // å¡«å……æ•°æ®
            const shuffled = shuffleArray([...students]);
            const cells = seatTable.getElementsByTagName('td');
            for (let i = 0; i < cells.length; i++) {
                cells[i].textContent = i < shuffled.length ? shuffled[i] : '';
            }

            showModal('seatModal');
        }


        // åœ¨DOMåŠ è½½æ—¶æ’å…¥èœå•
        document.addEventListener('DOMContentLoaded', () => {
            const navCollapse = document.querySelector('.nav-collapse');
            const menu = document.createElement('div');
            menu.className = 'nav-menu';
            menu.innerHTML = `
        <button onclick="showAboutModal()">å…³äº</button>
        <button onclick="showClassModal()">é€‰æ‹©ç­çº§</button>
        <button onclick="importList()">å¯¼å…¥åå•</button>
    `;
            navCollapse.appendChild(menu);
        });
        //ç¦æ­¢é€‰ä¸­æ–‡æœ¬
        document.onselectstart = function () { return false }

        //Electronåº”ç”¨å…³é—­å¤„ç†
        document.getElementById('minimize-btn').addEventListener('click', () => {
            window.electron.send('window-minimize');
        });

        document.getElementById('maximize-btn').addEventListener('click', () => {
            window.electron.send('window-maximize');
        });

        document.getElementById('close-btn').addEventListener('click', () => {
            window.electron.send('window-close');
        });

        //å…³äºæ¨¡æ€æ¡†
        function showAboutModal() {
            window.location.href = "about.html";
            //showModal('aboutModal');
        }
    </script>
    <script src="bootstrap.bundle.min.js"></script>
    <script src="sweetalert2@11.js"></script>
</body>

</html>